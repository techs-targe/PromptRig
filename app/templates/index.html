{% extends "base.html" %}

{% block title %}ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ  - Prompt Evaluation System{% endblock %}

{% block content %}
<div class="container">
    <!-- Tab Navigation -->
    <div class="tab-navigation">
        <button class="tab-button active" data-tab="single">å˜ç™ºå®Ÿè¡Œ / Single Execution</button>
        <button class="tab-button" data-tab="batch">ãƒãƒƒãƒå®Ÿè¡Œ / Batch Execution</button>
        <button class="tab-button" data-tab="projects">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š / Projects</button>
        <button class="tab-button" data-tab="settings">ã‚·ã‚¹ãƒ†ãƒ è¨­å®š / System Settings</button>
        <button class="tab-button" data-tab="datasets">ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ / Datasets</button>
    </div>

    <!-- Tab Content Areas -->

    <!-- Single Execution Tab -->
    <div id="tab-single" class="tab-content active">
        <div class="section">
            <h2>å˜ç™ºå®Ÿè¡Œ / Single Execution</h2>
            <div class="toolbar">
                <label>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ / Project:</label>
                <select id="single-project-select">
                    <option value="">Loading...</option>
                </select>
                <button id="btn-edit-prompt" class="btn btn-secondary">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›† / Edit Prompt</button>
                <button id="btn-edit-parser" class="btn btn-secondary">ãƒ‘ãƒ¼ã‚µãƒ¼ç·¨é›† / Edit Parser</button>
                <label style="margin-left: 20px;">ãƒ¢ãƒ‡ãƒ« / Model:</label>
                <select id="model-select">
                    <option value="azure-gpt-4.1">Azure GPT-4.1</option>
                    <option value="openai-gpt-4.1-nano">OpenAI GPT-4.1-nano</option>
                </select>
            </div>
        </div>

        <div class="main-content">
            <div class="left-pane">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <h3 style="margin: 0;">å®Ÿè¡Œå±¥æ­´ / History</h3>
                    <button id="btn-reload-single-history" class="btn btn-secondary btn-sm" style="padding: 0.2rem 0.5rem; font-size: 0.75rem;">ğŸ”„</button>
                </div>
                <div id="history-list" class="history-list">
                    <p class="loading">Loading...</p>
                </div>
            </div>

            <div class="right-pane">
                <div class="section">
                    <h3>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ / Prompt Template</h3>
                    <div class="prompt-template-box">
                        <pre id="prompt-template">Loading...</pre>
                    </div>
                </div>

                <div class="section">
                    <h3>å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ / Input Parameters</h3>
                    <form id="input-form">
                        <div id="parameter-inputs">
                            <p class="loading">Loading...</p>
                        </div>

                        <div class="execution-controls">
                            <button type="button" id="btn-send-once" class="btn btn-primary">
                                1ä»¶é€ä¿¡ / Send Once
                            </button>
                            <div class="repeat-control">
                                <label for="repeat-count">å›æ•° / Repeat:</label>
                                <input type="number" id="repeat-count" min="1" max="10" value="3">
                                <button type="button" id="btn-send-repeat" class="btn btn-secondary">
                                    nå›é€ä¿¡ / Send n Times
                                </button>
                                <label style="margin-left: 1rem;">
                                    <input type="checkbox" id="single-include-csv-header" checked>
                                    CSVãƒ˜ãƒƒãƒ€ã‚’ï¼‘è¡Œç›®ã®ã¿ã«å«ã‚ã‚‹ / Include CSV header in first row only
                                </label>
                            </div>
                            <button type="button" id="btn-stop-single" class="btn btn-danger" style="display: none; margin-left: 1rem;">
                                â¹ åœæ­¢ / Stop
                            </button>
                        </div>

                        <div id="execution-status" class="status-message"></div>
                    </form>
                </div>

                <div class="section">
                    <h3>å®Ÿè¡Œçµæœ / Results</h3>
                    <div id="results-area">
                        <p class="info">å®Ÿè¡ŒçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ / Results will be displayed here</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Batch Execution Tab -->
    <div id="tab-batch" class="tab-content">
        <div class="section">
            <h2>ãƒãƒƒãƒå®Ÿè¡Œ / Batch Execution</h2>
            <div class="toolbar">
                <label>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ / Project:</label>
                <select id="batch-project-select">
                    <option value="">Loading...</option>
                </select>
                <button id="btn-batch-edit-prompt" class="btn btn-secondary">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›† / Edit Prompt</button>
                <button id="btn-batch-edit-parser" class="btn btn-secondary">ãƒ‘ãƒ¼ã‚µãƒ¼ç·¨é›† / Edit Parser</button>
                <label style="margin-left: 20px;">ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ / Dataset:</label>
                <select id="batch-dataset-select">
                    <option value="">ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’é¸æŠ / Select Dataset</option>
                </select>
            </div>
            <div class="toolbar">
                <label>ãƒ¢ãƒ‡ãƒ« / Model:</label>
                <select id="batch-model-select">
                    <option value="azure-gpt-4.1">Azure GPT-4.1</option>
                    <option value="openai-gpt-4.1-nano">OpenAI GPT-4.1-nano</option>
                </select>
                <label style="margin-left: 1rem;">
                    <input type="checkbox" id="batch-include-csv-header" checked>
                    CSVãƒ˜ãƒƒãƒ€ã‚’ï¼‘è¡Œç›®ã®ã¿ã«å«ã‚ã‚‹ / Include CSV header in first row only
                </label>
                <button id="btn-batch-execute" class="btn btn-primary">ãƒãƒƒãƒå®Ÿè¡Œé–‹å§‹ / Start Batch</button>
                <button id="btn-stop-batch" class="btn btn-danger" style="display: none; margin-left: 1rem;">
                    â¹ åœæ­¢ / Stop
                </button>
            </div>
        </div>

        <div class="main-content">
            <div class="left-pane">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <h3 style="margin: 0;">ãƒãƒƒãƒã‚¸ãƒ§ãƒ–å±¥æ­´ / Batch Job History</h3>
                    <button id="btn-reload-batch-history" class="btn btn-secondary btn-sm" style="padding: 0.2rem 0.5rem; font-size: 0.75rem;">ğŸ”„</button>
                </div>
                <div id="batch-jobs-list" class="history-list">
                    <p class="loading">Loading...</p>
                </div>
            </div>

            <div class="right-pane">
                <div class="section">
                    <h3>ãƒãƒƒãƒå®Ÿè¡Œçµæœ / Batch Results</h3>
                    <div id="batch-results-area">
                        <p class="info">ãƒãƒƒãƒã‚¸ãƒ§ãƒ–ã‚’é¸æŠã™ã‚‹ã¨çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ / Select a batch job to view results</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Projects Tab -->
    <div id="tab-projects" class="tab-content">
        <div class="section">
            <h2>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š / Project Management</h2>
            <button id="btn-create-project" class="btn btn-primary">æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ / Create Project</button>
        </div>

        <div class="section">
            <h3>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ / Projects</h3>
            <div id="projects-list">
                <p class="loading">Loading...</p>
            </div>
        </div>
    </div>

    <!-- System Settings Tab -->
    <div id="tab-settings" class="tab-content">
        <div class="section">
            <h2>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š / System Settings</h2>
        </div>

        <div class="section">
            <h3>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ‡ãƒ«è¨­å®š / Default Model Configuration</h3>
            <div class="settings-group">
                <label>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆLLMãƒ¢ãƒ‡ãƒ« / Default LLM Model:</label>
                <select id="default-model-select" style="margin-left: 1rem; padding: 0.5rem;">
                    <option value="">Loading...</option>
                </select>
                <button id="btn-save-default-model" class="btn btn-primary" style="margin-left: 1rem;">ä¿å­˜ / Save</button>
                <p class="info" style="margin-top: 0.5rem;">é¸æŠã—ãŸãƒ¢ãƒ‡ãƒ«ãŒå˜ç™ºå®Ÿè¡Œãƒ»ãƒãƒƒãƒå®Ÿè¡Œç”»é¢ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ / Selected model will be used as default in single and batch execution screens</p>
            </div>
        </div>

        <div class="section">
            <h3>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š / Default Project Configuration</h3>
            <div class="settings-group">
                <label>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ / Default Project:</label>
                <select id="default-project-select" style="margin-left: 1rem; padding: 0.5rem;">
                    <option value="">Loading...</option>
                </select>
                <button id="btn-save-default-project" class="btn btn-primary" style="margin-left: 1rem;">ä¿å­˜ / Save</button>
                <p class="info" style="margin-top: 0.5rem;">é¸æŠã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå˜ç™ºå®Ÿè¡Œç”»é¢ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ / Selected project will be used as default in single execution screen</p>
            </div>
        </div>

        <div class="section">
            <h3>ãƒ¢ãƒ‡ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š / Model Parameters Configuration</h3>
            <div class="settings-group">
                <label>ãƒ¢ãƒ‡ãƒ«é¸æŠ / Select Model:</label>
                <select id="param-model-select" style="margin-left: 1rem; padding: 0.5rem;">
                    <option value="">Loading...</option>
                </select>
            </div>
            <div id="model-parameters-form" style="margin-top: 1rem; display: none;">
                <div class="form-group" id="param-temperature-group">
                    <label>Temperature (0-2):</label>
                    <input type="number" id="param-temperature" min="0" max="2" step="0.1" value="0.7" style="width: 100px; margin-left: 1rem;">
                    <span id="default-temperature" style="margin-left: 1rem; color: #7f8c8d; font-size: 0.9rem;"></span>
                </div>
                <div class="form-group" id="param-max-tokens-group">
                    <label>Max Tokens:</label>
                    <input type="number" id="param-max-tokens" min="100" max="32000" step="100" value="4000" style="width: 100px; margin-left: 1rem;">
                    <span id="default-max-tokens" style="margin-left: 1rem; color: #7f8c8d; font-size: 0.9rem;"></span>
                </div>
                <div class="form-group" id="param-top-p-group">
                    <label>Top P (0-1):</label>
                    <input type="number" id="param-top-p" min="0" max="1" step="0.1" value="1.0" style="width: 100px; margin-left: 1rem;">
                    <span id="default-top-p" style="margin-left: 1rem; color: #7f8c8d; font-size: 0.9rem;"></span>
                </div>
                <div class="form-group" id="param-verbosity-group" style="display: none;">
                    <label>Verbosity (GPT-5):</label>
                    <select id="param-verbosity" style="width: 150px; margin-left: 1rem;">
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                    </select>
                    <span id="default-verbosity" style="margin-left: 1rem; color: #7f8c8d; font-size: 0.9rem;"></span>
                </div>
                <div class="form-group" id="param-reasoning-effort-group" style="display: none;">
                    <label>Reasoning Effort (GPT-5):</label>
                    <select id="param-reasoning-effort" style="width: 150px; margin-left: 1rem;">
                        <option value="minimal">Minimal</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                    </select>
                    <span id="default-reasoning-effort" style="margin-left: 1rem; color: #7f8c8d; font-size: 0.9rem;"></span>
                </div>
                <div style="margin-top: 1rem;">
                    <button id="btn-save-model-params" class="btn btn-primary">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¿å­˜ / Save Parameters</button>
                    <button id="btn-reset-model-params" class="btn btn-secondary" style="margin-left: 1rem;">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™ / Reset to Defaults</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>LLMãƒ¢ãƒ‡ãƒ«è¨­å®š / LLM Model Configuration</h3>
            <div class="settings-group">
                <label>åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ« / Available Models (æœ‰åŠ¹åŒ–ã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«):</label>
                <div id="available-models">
                    <p class="loading">Loading...</p>
                </div>
            </div>

            <div class="settings-group" style="margin-top: 2rem;">
                <label>ãƒ¢ãƒ‡ãƒ«æœ‰åŠ¹åŒ–è¨­å®š / Model Activation Settings:</label>
                <p class="info" style="margin-bottom: 1rem;">
                    ã‚·ã‚¹ãƒ†ãƒ ã§åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ / Select models to make available in the system
                </p>
                <div id="model-enable-settings">
                    <p class="loading">Loading...</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>APIè¨­å®š / API Configuration</h3>
            <div class="settings-group">
                <p class="info">APIè¨­å®šã¯ .env ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã•ã‚Œã¾ã™ / API settings are managed in .env file</p>
                <ul>
                    <li>AZURE_OPENAI_ENDPOINT</li>
                    <li>AZURE_OPENAI_API_KEY</li>
                    <li>OPENAI_API_KEY</li>
                    <li>AZURE_OPENAI_GPT5_MINI_DEPLOYMENT_NAME (optional, defaults to AZURE_OPENAI_DEPLOYMENT_NAME)</li>
                    <li>AZURE_OPENAI_GPT5_NANO_DEPLOYMENT_NAME (optional, defaults to AZURE_OPENAI_DEPLOYMENT_NAME)</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h3>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ / Database</h3>
            <div class="settings-group">
                <label>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ / Database Path:</label>
                <p id="db-path">database/app.db</p>
            </div>
        </div>

        <div class="section">
            <h3>ã‚¸ãƒ§ãƒ–å®Ÿè¡Œè¨­å®š / Job Execution Settings</h3>
            <div class="settings-group">
                <label>ä¸¦åˆ—å®Ÿè¡Œæ•° / Job Parallelism (1-99):</label>
                <p class="info" style="margin-bottom: 1rem;">
                    åŒæ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚¸ãƒ§ãƒ–ã‚¢ã‚¤ãƒ†ãƒ ã®æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯1ï¼ˆç›´åˆ—å®Ÿè¡Œï¼‰ã§ã™ã€‚<br>
                    Set the number of job items to execute in parallel. Default is 1 (serial execution).
                </p>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <input type="number" id="job-parallelism" min="1" max="99" value="1" style="width: 100px;">
                    <button id="btn-save-parallelism" class="btn btn-primary">ä¿å­˜ / Save</button>
                    <span id="parallelism-status" style="color: #27ae60;"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Datasets Tab -->
    <div id="tab-datasets" class="tab-content">
        <div class="section">
            <h2>ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆç®¡ç† / Dataset Management</h2>
            <button id="btn-import-dataset" class="btn btn-primary">ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚¤ãƒ³ãƒãƒ¼ãƒˆ / Import Dataset</button>
        </div>

        <div class="section">
            <h3>ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆä¸€è¦§ / Datasets</h3>
            <div id="datasets-list">
                <p class="loading">Loading...</p>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<div id="modal-overlay" class="modal-overlay">
    <div id="modal-content" class="modal-content">
        <!-- Dynamic modal content -->
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="/static/js/app.js"></script>
{% endblock %}
